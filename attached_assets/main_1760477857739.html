<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Vøid Pæragon — Gateway</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <style>
    :root {
      --accent: #7a00ff;
    }
    body {
      background-color: #000;
      color: #e0e0e0;
      font-family: "Inter", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      text-align: center;
    }
    .card {
      background: rgba(20, 20, 20, 0.85);
      padding: 2rem;
      border: 1px solid var(--accent);
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 0 15px rgba(122, 0, 255, 0.2);
    }
    h1 {
      color: var(--accent);
      font-family: "Cinzel", serif;
      margin-bottom: 1rem;
    }
    input {
      margin-bottom: 1rem;
      width: 100%;
    }
    button {
      background-color: var(--accent);
      color: #fff;
      border: none;
      padding: 0.8rem;
      width: 100%;
      border-radius: 5px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      opacity: 0.8;
    }
    .switch {
      color: #aaa;
      margin-top: 1rem;
    }
    .switch a {
      color: var(--accent);
      text-decoration: none;
    }
    footer {
      position: absolute;
      bottom: 1rem;
      font-size: 0.9rem;
      color: #666;
    }
  </style>
</head>

<body>
  <div class="card" id="authCard">
    <h1>Enter the Vøid</h1>
    <form id="loginForm">
      <input type="email" id="loginEmail" placeholder="Email" required />
      <input type="password" id="loginPassword" placeholder="Password" required />
      <button type="submit">Log In</button>
      <p class="switch">Don’t have an account? <a href="#" id="toSignup">Sign Up</a></p>
      <p class="switch"><a href="#" id="visitor">Continue as Visitor</a></p>
    </form>

    <form id="signupForm" style="display:none;">
      <input type="email" id="signupEmail" placeholder="Email" required />
      <input type="password" id="signupPassword" placeholder="Password" required />
      <input type="text" id="signupUsername" placeholder="Choose a Username" required />
      <button type="submit">Sign Up</button>
      <p class="switch">Already registered? <a href="#" id="toLogin">Log In</a></p>
    </form>
  </div>

  <footer>© 2025 Vøid Pæragon</footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD5SkjADPqjkjEsmV_tUAk-KWNRFK59t_s",
      authDomain: "void-paragon-site.firebaseapp.com",
      databaseURL: "https://void-paragon-site-default-rtdb.firebaseio.com",
      projectId: "void-paragon-site",
      storageBucket: "void-paragon-site.firebasestorage.app",
      messagingSenderId: "109588109735",
      appId: "1:109588109735:web:611c31b37a4a1de5113e82"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const signupForm = document.getElementById("signupForm");
    const loginForm = document.getElementById("loginForm");
    const toSignup = document.getElementById("toSignup");
    const toLogin = document.getElementById("toLogin");
    const visitor = document.getElementById("visitor");

    toSignup.onclick = () => { loginForm.style.display = "none"; signupForm.style.display = "block"; };
    toLogin.onclick = () => { signupForm.style.display = "none"; loginForm.style.display = "block"; };

    // Sign up user
    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = signupEmail.value.trim();
      const password = signupPassword.value;
      const username = signupUsername.value.trim();

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        await sendEmailVerification(cred.user);

        await set(ref(db, "users/" + cred.user.uid), {
          username,
          email,
          role: email === "paragon3467@gmail.com" ? "admin" : "user",
          verified: false
        });

        alert("Sign-up successful! Verification email sent.");
        signupForm.reset();
        signupForm.style.display = "none";
        loginForm.style.display = "block";
      } catch (error) {
        alert(error.message);
      }
    });

    // Log in user
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = loginEmail.value.trim();
      const password = loginPassword.value;

      try {
        const cred = await signInWithEmailAndPassword(auth, email, password);
        const userRef = ref(db, "users/" + cred.user.uid);
        const snap = await get(userRef);
        const data = snap.val();

        if (!cred.user.emailVerified && data.role !== "admin") {
          alert("Please verify your email before logging in.");
          await signOut(auth);
          return;
        }

        localStorage.setItem("vp_email", email);
        localStorage.setItem("vp_role", data.role || "user");
        localStorage.setItem("vp_username", data.username);

        if (data.role === "admin") window.location.href = "dashboard.html";
        else window.location.href = "home.html";
      } catch (error) {
        alert(error.message);
      }
    });

    // Continue as visitor
    visitor.onclick = () => {
      localStorage.setItem("vp_email", "guest_A" + Math.floor(1000 + Math.random() * 9000));
      localStorage.setItem("vp_role", "visitor");
      window.location.href = "home.html";
    };
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendEmailVerification } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getDatabase, ref, set, get, child, update, push, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
  import { getStorage, ref as sRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5SkjADPqjkjEsmV_tUAk-KWNRFK59t_s",
    authDomain: "void-paragon-site.firebaseapp.com",
    databaseURL: "https://void-paragon-site-default-rtdb.firebaseio.com",
    projectId: "void-paragon-site",
    storageBucket: "void-paragon-site.firebasestorage.app",
    messagingSenderId: "109588109735",
    appId: "1:109588109735:web:611c31b37a4a1de5113e82"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);
  const storage = getStorage(app);

  // Example: Auto-detect user state
  onAuthStateChanged(auth, user => {
    if (user) {
      console.log("Logged in as:", user.email);
      localStorage.setItem("vp_email", user.email);
    } else {
      console.log("No user logged in.");
      localStorage.removeItem("vp_email");
    }
  });
</script>
</body>
