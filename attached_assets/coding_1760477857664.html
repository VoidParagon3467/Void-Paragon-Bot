<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coding | VÃ¸id PÃ¦ragon</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css">
<style>
:root{--accent:#7a00ff;--bg:#000;--text:#eee;}
body{margin:0;background:var(--bg);color:var(--text);font-family:"Inter",sans-serif;overflow-x:hidden;}
header{position:fixed;top:0;left:0;width:100%;height:60px;background:#0a0a0a;
border-bottom:2px solid var(--accent);display:flex;justify-content:space-between;align-items:center;
padding:0 1rem;z-index:1000;}
#menuBtn{font-size:1.8rem;cursor:pointer;color:var(--accent);}
#userName{font-weight:600;color:var(--accent);}
#sideMenu{position:fixed;top:0;left:-260px;width:240px;height:100%;background:#111;
border-right:2px solid var(--accent);transition:left .3s ease;z-index:999;display:flex;
flex-direction:column;justify-content:space-between;}
#sideMenu.active{left:0;}
#menuProfile{text-align:center;padding-top:70px;}
#menuProfile img{width:80px;height:80px;border-radius:50%;border:2px solid var(--accent);}
#menuProfile h3{margin:.5rem 0;font-family:"Cinzel",serif;color:var(--accent);}
#menuLinks a{display:block;color:var(--text);text-decoration:none;padding:.8rem 1rem;
border-bottom:1px solid #222;transition:.3s;}
#menuLinks a:hover{background:var(--accent);color:#fff;}
#logout{display:block;color:#fff;text-decoration:none;background:#7a00ff;text-align:center;
padding:.9rem;font-weight:600;}

main{padding:5rem 1rem 2rem;max-width:1000px;margin:auto;}
h1{font-family:"Cinzel",serif;color:var(--accent);text-align:center;margin-bottom:1rem;}
#editor-container{background:#111;border:1px solid #222;border-radius:8px;padding:0.5rem;}
#toolbar{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.5rem;}
button{background:var(--accent);color:#fff;border:none;padding:.4rem .8rem;
border-radius:4px;cursor:pointer;}
button:hover{opacity:.8;}
#editor{height:300px;border-radius:5px;background:#0d0d0d;color:#eee;font-size:15px;}
#console{background:#111;border:1px solid #333;margin-top:1rem;padding:.5rem;height:150px;
overflow:auto;border-radius:5px;}
iframe#preview{width:100%;height:250px;border:none;background:#fff;margin-top:1rem;}

.collapsible{background:#111;border:1px solid #222;padding:1rem;border-radius:8px;margin-top:1.5rem;}
.collapsible h2{color:var(--accent);cursor:pointer;margin-bottom:0;}
.collapsible-content{display:none;margin-top:.5rem;}
.collapsible.active .collapsible-content{display:block;}
.lesson{border:1px solid #333;border-radius:6px;padding:.6rem;margin:.4rem 0;background:#0b0b0b;}
.lesson.locked{opacity:.5;pointer-events:none;}
</style>
</head>

<body>
<header>
  <div id="menuBtn">â˜°</div>
  <div style="display:flex;align-items:center;gap:.5rem;">
    <span id="userName">Guest_A004</span>
  </div>
</header>

<nav id="sideMenu">
  <div>
    <div id="menuProfile">
      <img src="https://i.ibb.co/rGsK70vJ/file-000000006cd8620d81ac8a03bfac11c8.jpg" alt="">
      <h3>VÃ¸id PÃ¦ragon</h3>
    </div>
    <div id="menuLinks">
      <a href="homepage.html">ğŸ  Home</a>
      <a href="homefeed.html">ğŸ“ƒ Feed</a>
      <a href="Novels.html">ğŸ“š Novels</a>
      <a href="coding.html">ğŸ’» Coding</a>
      <a href="community.html">ğŸŒ Community</a>
      <a href="notifications.html" class="active">ğŸ”” Notifications</a>
      <a href="profile.html">ğŸ‘¤ Profile</a>
      <a href="support.html">ğŸ’¬ Support</a>
    </div>
  </div>
  <a href="#" id="logout">ğŸšª Log Out</a>
</nav>

<main>
  <h1>Code in the VÃ¸id</h1>
  <div id="editor-container">
    <div id="toolbar">
      <select id="language">
        <option value="python">Python</option>
        <option value="javascript">JavaScript</option>
        <option value="html">HTML/CSS</option>
      </select>
      <button id="run">Run â–¶</button>
      <button id="save">Save ğŸ’¾</button>
      <button id="clear">Clear ğŸ—‘</button>
      <button id="download">Download â¬‡</button>
    </div>
    <textarea id="editor"></textarea>
  </div>
  <div id="console"></div>
  <iframe id="preview" style="display:none;"></iframe>

  <div class="collapsible" id="libraryPanel">
    <h2>ğŸ“‚ Code Library</h2>
    <div class="collapsible-content" id="library"></div>
  </div>

  <div class="collapsible" id="coursesPanel">
    <h2>ğŸ“˜ Coding Courses</h2>
    <div class="collapsible-content" id="courses"></div>
  </div>
</main>

<footer style="text-align:center;padding:1rem;color:#555;">Â© 2025 VÃ¸id PÃ¦ragon</footer>

<script src="https://cdn.jsdelivr.net/npm/pyodide@0.26.0/pyodide.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/javascript/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/css/css.min.js"></script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD5SkjADPqjkjEsmV_tUAk-KWNRFK59t_s",
    authDomain: "void-paragon-site.firebaseapp.com",
    databaseURL: "https://void-paragon-site-default-rtdb.firebaseio.com",
    projectId: "void-paragon-site",
    storageBucket: "void-paragon-site.firebasestorage.app",
    messagingSenderId: "109588109735",
    appId: "1:109588109735:web:611c31b37a4a1de5113e82"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  /* === MENU FUNCTIONALITY === */
  const menuBtn = document.getElementById("menuBtn");
  const sideMenu = document.getElementById("sideMenu");
  menuBtn.onclick = () => sideMenu.classList.toggle("active");

  /* === CODE EDITOR === */
  let editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
    lineNumbers: true,
    theme: "default",
    mode: "python",
    tabSize: 4,
    indentUnit: 4,
    smartIndent: true,
    matchBrackets: true,
    autoCloseBrackets: true
  });

  const consoleBox = document.getElementById("console");
  const preview = document.getElementById("preview");
  const language = document.getElementById("language");

  let pyodideReady = false;
  let pyodide;

  async function loadPy() {
    pyodide = await loadPyodide();
    pyodideReady = true;
  }
  loadPy();

  language.onchange = () => {
    const lang = language.value;
    editor.setOption("mode", lang === "html" ? "xml" : lang);
    consoleBox.textContent = "";
    preview.style.display = lang === "html" ? "block" : "none";
  };

  document.getElementById("run").onclick = async () => {
    const code = editor.getValue();
    const lang = language.value;
    consoleBox.textContent = "";

    if (lang === "python") {
      if (!pyodideReady) {
        consoleBox.textContent = "Loading Python...";
        await loadPy();
      }
      try {
        let out = await pyodide.runPythonAsync(code);
        consoleBox.textContent = out ?? "Done.";
      } catch (e) {
        consoleBox.textContent = e;
      }
    } else if (lang === "javascript") {
      try {
        consoleBox.textContent = eval(code);
      } catch (e) {
        consoleBox.textContent = e;
      }
    } else if (lang === "html") {
      preview.style.display = "block";
      preview.srcdoc = code;
      consoleBox.textContent = "HTML/CSS preview rendered below.";
    }
  };

  document.getElementById("clear").onclick = () => {
    editor.setValue("");
    consoleBox.textContent = "";
  };

  document.getElementById("download").onclick = () => {
    const blob = new Blob([editor.getValue()], { type: "text/plain" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `code.${language.value}`;
    a.click();
  };

  /* === LIBRARY SYNC === */
  const libraryDiv = document.getElementById("library");

  async function loadLibrary(userId) {
    libraryDiv.innerHTML = "<p>Loading your code library...</p>";
    let localSaves = JSON.parse(localStorage.getItem("vp_codes") || "[]");

    if (userId) {
      const snap = await get(child(ref(db), "codeLibrary/" + userId));
      if (snap.exists()) {
        const cloudSaves = snap.val();
        localSaves = Object.values(cloudSaves);
        localStorage.setItem("vp_codes", JSON.stringify(localSaves));
      }
    }

    renderLibrary(localSaves);
  }

  function renderLibrary(saves) {
    libraryDiv.innerHTML = "";
    if (!saves.length) {
      libraryDiv.innerHTML = "<p>No saved works yet.</p>";
      return;
    }
    saves.forEach((item, i) => {
      const div = document.createElement("div");
      div.innerHTML = `<b>${item.name}</b> (${item.lang})
        <button onclick="openCode(${i})">Open</button>
        <button onclick="deleteCode(${i})">Delete</button>`;
      libraryDiv.appendChild(div);
    });
  }

  document.getElementById("save").onclick = async () => {
    const name = prompt("Save as:") || "Untitled";
    const codeData = { name, lang: language.value, code: editor.getValue() };

    let saves = JSON.parse(localStorage.getItem("vp_codes") || "[]");
    saves.push(codeData);
    localStorage.setItem("vp_codes", JSON.stringify(saves));
    renderLibrary(saves);

    if (auth.currentUser) {
      const userId = auth.currentUser.uid;
      const newRef = ref(db, `codeLibrary/${userId}/${Date.now()}`);
      await set(newRef, codeData);
    }
  };

  window.openCode = (i) => {
    const saves = JSON.parse(localStorage.getItem("vp_codes") || "[]");
    const s = saves[i];
    language.value = s.lang;
    editor.setValue(s.code);
  };

  window.deleteCode = async (i) => {
    let saves = JSON.parse(localStorage.getItem("vp_codes") || "[]");
    const deleted = saves.splice(i, 1)[0];
    localStorage.setItem("vp_codes", JSON.stringify(saves));
    renderLibrary(saves);

    if (auth.currentUser) {
      const userId = auth.currentUser.uid;
      const userRef = ref(db, `codeLibrary/${userId}`);
      const snap = await get(userRef);
      if (snap.exists()) {
        const entries = snap.val();
        const key = Object.keys(entries).find(
          (k) =>
            entries[k].name === deleted.name && entries[k].code === deleted.code
        );
        if (key) await update(ref(db, `codeLibrary/${userId}/${key}`), null);
      }
    }
  };

  onAuthStateChanged(auth, (user) => {
    if (user) loadLibrary(user.uid);
    else loadLibrary(null);
  });

  /* === COURSES === */
  const coursesDiv = document.getElementById("courses");
  const courseData = {
    python: [
      "Intro to Python",
      "Variables & Data Types",
      "Loops & Functions",
      "OOP Basics ğŸ”’",
      "File Handling ğŸ”’"
    ],
    javascript: [
      "Intro to JS",
      "DOM & Events",
      "Async JS",
      "APIs ğŸ”’",
      "Frameworks ğŸ”’"
    ],
    html: [
      "Intro to HTML",
      "CSS Styling",
      "Forms & Layout",
      "Flexbox ğŸ”’",
      "Responsive Design ğŸ”’"
    ]
  };

  for (const lang in courseData) {
    const div = document.createElement("div");
    div.innerHTML = `<h3 style="color:var(--accent);">${lang.toUpperCase()}</h3>`;
    courseData[lang].forEach((lesson) => {
      const l = document.createElement("div");
      l.className = "lesson" + (lesson.includes("ğŸ”’") ? " locked" : "");
      l.textContent = lesson;
      div.appendChild(l);
    });
    coursesDiv.appendChild(div);
  }

  document.querySelectorAll(".collapsible h2").forEach((h) => {
    h.onclick = () => h.parentElement.classList.toggle("active");
  });
</script>
</body>
</html>